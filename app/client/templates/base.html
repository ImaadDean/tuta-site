<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}E-Commerce Store{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "spanish-gray": "hsl(0, 0%, 60%)",
              "sonic-silver": "hsl(0, 0%, 47%)",
              "eerie-black": "hsl(0, 0%, 13%)",
              "salmon-pink": "hsl(353, 100%, 78%)",
              "sandy-brown": "hsl(29, 90%, 65%)",
              bittersweet: "hsl(0, 100%, 70%)",
              "ocean-green": "hsl(152, 51%, 52%)",
              "davys-gray": "hsl(0, 0%, 33%)",
              cultured: "hsl(0, 0%, 93%)",
              onyx: "hsl(0, 0%, 27%)",
            },
            fontFamily: {
              poppins: ["Poppins", "sans-serif"],
            },
          },
        },
      };
    </script>
    <style>
      .cart-overlay {
        transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
      }
      .cart-panel {
        transition: transform 0.3s ease-in-out;
      }
      [x-cloak] {
        display: none !important;
      }
    </style>
  </head>
  <body class="flex flex-col min-h-screen">
    <div
      x-data="{ 
        cartOpen: false,
        cart: [],
        saveCart() {
            localStorage.setItem('cart', JSON.stringify(this.cart));
        },
        loadCart() {
            this.cart = JSON.parse(localStorage.getItem('cart') || '[]');
        },
        addToCart(product) {
            const existingItem = this.cart.find(item => item.id === product.id);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                this.cart.push({ ...product, quantity: 1 });
            }
            this.saveCart();
            this.animateCartButton();
        },
        removeFromCart(productId) {
            this.cart = this.cart.filter(item => item.id !== productId);
            this.saveCart();
        },
        updateQuantity(productId, delta) {
            const item = this.cart.find(item => item.id === productId);
            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) {
                    this.removeFromCart(productId);
                } else {
                    this.saveCart();
                }
            }
        },
        cartTotal() {
            return this.cart.reduce((total, item) => total + item.price * item.quantity, 0).toFixed(2);
        },
        animateCartButton() {
            anime({
                targets: '#cartButton',
                scale: [1, 1.2, 1],
                duration: 300,
                easing: 'easeInOutQuad'
            });
        },
        uniqueItemsCount() {
            return this.cart.length;
        },
        totalItemsCount() {
            return this.cart.reduce((total, item) => total + item.quantity, 0);
        },
        proceedToCheckout() {
            if (this.cart.length === 0) {
                alert('Your cart is empty');
                return;
            }
            window.location.href = '/checkout';
        }
    }"
      x-init="loadCart(); $watch('cart', () => saveCart())"
    >
      <nav class="bg-white shadow-sm">
        <div class="max-w-6xl mx-auto px-4">
          <div class="flex items-center justify-between h-16">
            <a href="/" class="text-xl font-semibold text-gray-900">Store</a>
            <button
              @click="cartOpen = true"
              id="cartButton"
              class="relative p-2 text-gray-600 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-md"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"
                />
              </svg>
              <span
                x-show="cart.length > 0"
                x-text="uniqueItemsCount()"
                class="absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-blue-600 rounded-full"
              >
              </span>
            </button>
          </div>
        </div>
      </nav>

      <!-- Updated main element with more spacing -->
      <main class="flex-grow py-6 md:py-8 lg:py-10 lg:mx-16 lg:px-2">
        {% block content %}{% endblock %}
      </main>

      <!-- Include cart component -->
      {% include "components/cart.html" %}
    </div>

    <footer class="bg-white mt-8 py-4 border-t">
      <div class="max-w-6xl mx-auto px-4 text-center text-gray-600">
        <p>&copy; 2024 Store. All rights reserved.</p>
      </div>
    </footer>
  </body>
</html>
